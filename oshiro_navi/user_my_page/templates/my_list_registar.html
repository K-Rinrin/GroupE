{% extends "user_base.html" %}
{% load static %}

{% block title %}お城マイリスト{% endblock %}

{% block content %}

    <div class="mypage-container mylist-container">
        <h1 class="page-title">お城マイリスト</h1>

        <section class="mylist-section">
            <h2 class="section-title">お気に入りに追加するお城</h2>
            
            <form method="get" class="search-box-wrapper">
                <label class="sub-label">お城名で検索</label>
                <div class="search-row">
                    <input type="text" name="keyword" class="form-input" 
                           placeholder="お城名を入力してください" value="{{ keyword }}">
                    <button type="submit" class="btn-search">検索</button>
                </div>
            </form>

            <form method="post">
                {% csrf_token %}

                {% if messages %}
                    <div class="error-messages" style="margin-bottom: 15px;">
                        {% for message in messages %}
                            <p style="color: #ff0000; font-weight: bold; font-size: 14px; margin: 0;">
                                ⚠️ {{ message }}
                            </p>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="scroll-selection-box" style="border: 1px solid #ccc; height: 200px; overflow-y: scroll; padding: 10px; margin-bottom: 20px; background: #fff;">
                    
                    {% for castle in available_castles %}
                    <label class="checkbox-item" style="display: block; margin-bottom: 8px; cursor: pointer;">
                        <input type="checkbox" name="castle_ids" value="{{ castle.id }}">
                        <span class="castle-label-text">
                            {{ castle.oshiro_name }} ({{ castle.address }})
                        </span>
                    </label>
                    {% empty %}
                    <div style="padding:10px; color:#666; font-size:14px;">
                        {% if keyword %}
                            「{{ keyword }}」に該当するお城が見つかりませんでした。
                        {% else %}
                            お城名を入力して検索してください。
                        {% endif %}
                    </div>
                    {% endfor %}

                </div>

                <div class="button-group">
                    <button type="submit" name="add" class="btn-submit">選択したお城をお気に入りに追加</button>
                </div>
            </form>
        </section>


        <section class="mylist-section">
            <h2 class="section-title">現在のお気に入り</h2>

            <div class="current-list-box" style="border: 1px solid #eee; padding: 10px; border-radius: 5px; background: #f9f9f9;">
                
                {% for item in current_mylist %}
                <div class="list-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #ddd;">
                    <span class="item-name" style="font-size: 15px;">{{ item.oshiro_info.oshiro_name }} ({{ item.oshiro_info.address }})</span>
                    
                    <a href="{% url 'usermy_page:mylistdeletecheck' pk=item.id %}" 
                       class="btn-small-delete" 
                       style="
                            background-color: #d9534f; 
                            color: #ffffff !important; 
                            text-decoration: none !important; 
                            font-weight: bold; 
                            font-size: 15px; 
                            padding: 8px 18px; 
                            border-radius: 4px; 
                            display: inline-block;
                            text-align: center;
                            line-height: 1;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                       ">
                       削除
                    </a>
                </div>
                {% empty %}
                <div style="padding:15px; color:#666; font-size:14px;">
                    まだお気に入りが登録されていません。
                </div>
                {% endfor %}

            </div>
        </section>

        <div class="button-group" style="margin-top: 30px;">
            <a href="{% url 'usermy_page:mypage' %}" class="btn-cancel">マイページに戻る</a>
        </div>

    </div>

{% endblock %}